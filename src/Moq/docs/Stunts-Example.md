# Stunts Full Example

Given the following interface that exercises most (all?) calling conventions in a .NET interface:

```csharp
public interface ICalculator
{
    event EventHandler TurnedOn;
    
    bool IsOn { get; }
    
    CalculatorMode Mode { get; set; }
    
    int Add(int x, int y);

    bool TryAdd(ref int x, ref int y, out int result);
    
    void TurnOn();

    int? this[string name] { get; set; }

    void Store(string name, int value);

    int? Recall(string name);

    void Clear(string name);
}
```

The interface could be implemented as a stunt using the behavior pipeline as follows:

```csharp
public class ICalculatorStunt : ICalculator, IStunt
{
    readonly BehaviorPipeline pipeline = new BehaviorPipeline();

    ObservableCollection<IStuntBehavior> IStunt.Behaviors => pipeline.Behaviors;

    public int? this[string name] 
    {
        get => pipeline.Execute<int?>(new MethodInvocation(this, MethodBase.GetCurrentMethod(), name)); 
        set => pipeline.Execute(new MethodInvocation(this, MethodBase.GetCurrentMethod(), name, value)); 
    }

    public bool IsOn => pipeline.Execute<bool>(new MethodInvocation(this, MethodBase.GetCurrentMethod()));

    public CalculatorMode Mode 
    {
        get => pipeline.Execute<CalculatorMode>(new MethodInvocation(this, MethodBase.GetCurrentMethod())); 
        set => pipeline.Execute(new MethodInvocation(this, MethodBase.GetCurrentMethod(), value)); 
    }

    public int Add(int x, int y) => pipeline.Execute<int>(new MethodInvocation(this, MethodBase.GetCurrentMethod(), x, y));

    public void Clear(string name) => pipeline.Execute(new MethodInvocation(this, MethodBase.GetCurrentMethod(), name));

    public int? Recall(string name) => pipeline.Execute<int?>(new MethodInvocation(this, MethodBase.GetCurrentMethod(), name));

    public void Store(string name, int value) => pipeline.Execute(new MethodInvocation(this, MethodBase.GetCurrentMethod(), name, value));

    public bool TryAdd(ref int x, ref int y, out int result)
    {
        result = default(int);
        var returns = pipeline.Execute(new MethodInvocation(this, MethodBase.GetCurrentMethod(), x, y, result));
        x = (int)returns.Outputs["x"];
        y = (int)returns.Outputs["y"];
        result = (int)returns.Outputs["result"];
        return (bool)returns.ReturnValue;
    }

    public void TurnOn() => pipeline.Execute(new MethodInvocation(this, MethodBase.GetCurrentMethod()));

    public event EventHandler TurnedOn 
    {
        add => pipeline.Execute<EventHandler>(new MethodInvocation(this, MethodBase.GetCurrentMethod(), value)); 
        remove => pipeline.Execute<EventHandler>(new MethodInvocation(this, MethodBase.GetCurrentMethod(), value)); 
    }
}
```

This is exactly the code that is generated by the *Stunt* analyzer+codefix, so you typically don't need to write this by hand:

![Stunts CodeFix](https://raw.githubusercontent.com/moq/moq/docs/docs/img/Stunts_CodeFix.png)
